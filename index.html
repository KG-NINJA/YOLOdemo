<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YOLOv8 Telemetry Demo</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="wrap">
    <header>
      <h1>YOLOv8 × セカイOCRビジョンパネル</h1>
      <p>YOLOv8 推論で検出した情報を H/E/S/EV テレメトリに統合し、300ms 間隔で更新します。</p>
    </header>

    <div class="controls">
      <div class="control-group">
        <button id="toggle">開始</button>
        <span class="status" id="status">待機中</span>
        <span class="clock">Clock: <span id="clock">--:--:--</span></span>
        <span class="status">Model: <span id="modelStatus">IDLE</span></span>
        <span class="status">Backend: <span id="backend">--</span></span>
      </div>
      <div class="control-group sliders">
        <label>しきい値 <input id="threshold" type="range" min="0.1" max="0.95" step="0.01" value="0.35"><span class="mono" id="thVal">35%</span></label>
        <label>モデル <select id="modelSelect"><option value="yolov8n">YOLOv8n</option><option value="yolov8m">YOLOv8m</option><option value="yolov8l">YOLOv8l</option><option value="yolov8n-quantized">YOLOv8n-quantized</option></select></label>
        <button id="exportFrame" class="ghost">フレーム保存</button>
        <button id="exportTelemetry" class="ghost">テレメトリCSV</button>
      </div>
      <div class="control-group">
        <div class="targets">
          <span>モデル状態:</span>
          <span class="mono" id="performance">Inference: -- ms · FPS --</span>
        </div>
      </div>
    </div>

    <div class="layout">
      <div class="stage" aria-label="物体検知プレビュー">
        <video id="video" autoplay playsinline muted></video>
        <canvas id="canvas"></canvas>
        <div class="ocr-panel" aria-live="polite" aria-label="AIステータスパネル">
          <pre id="panel-text">H ---%
E ----
S ----
EV ---</pre>
        </div>
      </div>
      <div class="info">
        <div class="card">
          <h3>AI パネル状態</h3>
          <div class="value" id="evCode">EV ---</div>
          <p class="desc">H/E/S/EV コードは 300ms ごとに更新。パネルは 150×100px のモノスペース表示。</p>
        </div>
        <div class="card">
          <h3>YOLO 検出サマリ</h3>
          <div class="value mono" id="detectionSummary">Top: -- / Total -- / Avg --</div>
          <p class="desc">信頼度順の上位クラス、クラスごとの合計、平均信頼度を表示します。</p>
        </div>
        <div class="metrics">
          <div class="card">
            <h3>Ambient Window</h3>
            <div class="value mono" id="ambient">--.- % / min -- / max --</div>
            <p class="desc">160×120 サンプルの平均輝度と最小・最大を表示します。</p>
          </div>
          <div class="card">
            <h3>Contrast & Motion</h3>
            <div class="value mono" id="contrast">std --.- / motion --.-</div>
            <p class="desc">標準偏差でコントラストを、フレーム差分でモーションスコアを算出します。</p>
          </div>
          <div class="card">
            <h3>Color Bias</h3>
            <div class="value mono" id="color">R --.- / G --.- / B --.-</div>
            <p class="desc">チャネル平均の偏りを検知し、環境コード EV に反映します。</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <canvas id="sample" class="sr-only" width="160" height="120"></canvas>

  <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
  <script type="module" src="./js/main.js"></script>
</body>
</html>
